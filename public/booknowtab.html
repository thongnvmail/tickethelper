
<head>
    <style type="text/css">
        .unread {
            font-weight: bold;
            background-color: #999;
        }

        .read {
            font-weight: normal;
            background-color: #FFF;
        }
    </style>

    <script type="text/javascript">

        var lengthItemNew = 0;
        var lengtItemCurrent = 0;

        function loadInit() {
            var url = "/bookingHelper/request";
            var request = $.ajax({
                url : url,
                method : "GET",
                dataType : "JSON"
            })

            request.done((result) => {
                console.log(result);
                console.log(result.book_now);
                var book_now = result.book_now;
                var str = ``;
                book_now.map((valuse, index) => {
                    console.log(valuse.subject);
                    let id = valuse.id;
                    let subject = valuse.subject;
                    let requester = valuse.requester;
                    let isRead = valuse.isRead;
                    let classStatus = "unread";
                    if(isRead) {
                        classStatus = "read";
                    }
                    str += `
                        <tr class='${classStatus}' onclick="onClickTable('${id}', this)">
                            <td><b> ${subject} </b></td>
                            <td>${requester}</td>
                        </tr>
                    `;
                })

                $("#datatable").html(str);
                $("#total").html(book_now.length);
                lengtItemCurrent = book_now.length;
            })

            request.fail((jqXHR, textStatus) => {
                console.log(textStatus);
            })
        }

        function loadData() {
            var url = "/bookingHelper/request";
            var request = $.ajax({
                url : url,
                method : "GET",
                dataType : "JSON"
            })

            request.done((result) => {
                console.log(result);
                console.log(result.book_now);
                var book_now = result.book_now;
                if(book_now.length > lengtItemCurrent) {
                    var str = ``;
                    book_now.map((valuse, index) => {
                        console.log(valuse.subject);
                        let id = valuse.id;
                        let subject = valuse.subject;
                        let requester = valuse.requester;
                        let isRead = valuse.isRead;
                        let classStatus = "unread";
                        if(isRead) {
                            classStatus = "read";
                        }
                        str += `
                            <tr class='${classStatus}' onclick="onClickTable('${id}', this)">
                                <td><b> ${subject} </b></td>
                                <td>${requester}</td>
                            </tr>
                        `;
                    })

                    $("#datatable").html(str);
                    $("#total").html(book_now.length);
                    lengtItemCurrent = book_now.length;
                }
                
            })

            request.fail((jqXHR, textStatus) => {
                console(textStatus);
            })
        }

        function onClickTable(id, event) {
            // console.log(event);
            $(event).removeClass();
            var url = "/bookingHelper/request/" + id;
            var request = $.ajax({
                url : url,
                method : "GET",
                dataType : "JSON"
            })

            request.done((result) => {
                console.log(result);
                let id = result.id;
                let subject = result.subject;
                let requester = result.requester;
                let product_booking = result.product_booking;
                let address_booking = result.address_booking;
                let content = result.content;
                let isRead = result.isRead;

                $("#id").html(id);
                $("#subject").html(subject);
                $("#requester").html(requester);
                $("#product_booking").html(product_booking);
                $("#address_booking").html(address_booking);
                $("#content").html(content);

                if(!isRead) {
                    updateStatus(result);
                }
                
            })

            request.fail((jqXHR, textStatus) => {
                console(textStatus);
            })
        }

        function updateStatus(data) {
            var url = "/bookingHelper/request/" + data.id;
            data.isRead = true;
            var request = $.ajax({
                url : url,
                method : "PUT",
                data: data,
                dataType : "JSON"
            })

            request.done((result) => {
                console.log("Update status success");
                // loadNewData();
                // loadData();
            })

            request.fail((jqXHR, textStatus) => {
                console.log(textStatus);
            })
        }

        function cancle() {
            // alert('Hủy yêu cầu thành công');
            var id = $("#id").html();
            var message = 'Hủy yêu cầu thành công';
            notify(message + " " + id, 'success');
        }

        function approve() {
            // alert('Đã gửi yêu cầu thành công');
            var id = $("#id").html();
            var message = 'Đã gửi yêu cầu thành công';
            notify(message + " " + id, 'success');
        }

        loadInit();
        function autoLoad1() {
            setTimeout(function(){ 
                loadData();
                autoLoad1();
            }, 500);
        }

        loadData();
        autoLoad1();
    </script>
</head>

<div class="content">
    <div class="container-fluid">
        <div class="row">

            <div class="col-md-4">
                <div class="card">
                    <div class="header">
                        <h4 class="title">Danh sách gọi xe</h4>
                    </div>
                    <div class="content">

                        <div class="content table-responsive table-full-width" style="height: 400px; overflow: auto;">
                            <table class="table table-hover">
                                <tbody id='datatable'>
                            
                                </tbody>
                            </table>
                        </div>

                        <div class="footer">
                            <hr>
                            <div class="stats">
                                <i class="fa fa-clock-o"></i>Tổng số: <b id="total"></b>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-8">
                <div class="card">
                    <div class="header">
                        <h4 style="text-transform: capitalize;" class="title" id="subject">Tiêu đề</h4>
                    </div>
                    <br>
                    <table class="table">
                        <tr>
                            <td style="width: 20%;">ID</td>
                            <td><b id="id"></b></td>
                        </tr>
                        <tr>
                            <td style="width: 20%;">Người gửi</td>
                            <td><b id="requester"></b></td>
                        </tr>
                        <tr>
                            <td style="">Loại xe</td>
                            <td><b id="product_booking"></b></td>
                        </tr>
                        <tr>
                            <td>Địa điểm</td>
                            <td><b id="address_booking"></b></td>
                        </tr>
                        <tr>
                            <td>Nội dung</td>
                            <td><b id="content"></b></td>
                        </tr>
                        <tr>
                            <td><button type="button" class="btn btn-danger" onclick="cancle()">Hủy yêu cầu</button></td>
                            <td><button type="button" class="btn btn-success" onclick="approve()">Chấp nhận</button></td>
                        </tr>
                    </table>
                    
                </div>
            </div>

        </div>
    </div>
</div>

